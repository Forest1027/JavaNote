# Day1
tomcat的并发量撑死400多个。

如何解决高并发和高可用

高并发：同一时间访问服务器的量
高可用：随时都可以用，什么情况都能用。使用集群解决

【待确定】
当当等大网站，并发量有一万就差不多了
十一那天，淘宝的并发量是一亿

1. 什么是分布式？
	1. 
2. 什么是集群？
	1. 一群服务器提供相同的服务

## 高并发的解决
>Tomcat集群是什么样的集群？
>设置session共享。其中一个tomcat的session改了，就要发送session信息，让别的也进行更改。因此tomcat集群超过5个，容易形成内网风暴（只能传session，处理不了逻辑了）
>使用nginx，并发量最高支持两万，一般算一万。并发量超过500，就使用nginx

软件无能为力，就考虑硬件：
f5负载均衡服务器。并发量4-5万

硬件也不够了，就考虑网络：
DNS服务器。从区域上就分开，不同地区访问不同服务器

处理请求的速度，也会影响并发量。让cpu少处理tomcat，多处理业务逻辑。-->分布式（将完整的系统拆成多个子系统，一起运行）

分布与集群的区别：
分布-运行的代码不同
集群-运行的代码相同

子系统间的通信 dubbo，hessian，CXF Webservice

高可用也是搭建集群来解决

## 工程构建
pojo,dao,interface单独达成jar包的目的：方便别人使用，直接依赖过去就好

什么是Maven project？什么是Maven module？

依赖管理和依赖的区别？
依赖管理：定义要使用jar包的版本
依赖：具体要使用的jar包
先进行管理，再进行导包

# Day2
1. 练习linux命令
2. dubbo
	1. 为什么使用dubbo
		1. 基于rpc协议（远程调用协议），使用socket通信。**可以统计出系统之间的调用关系和调用次数。**【可以观察出哪里需要搭建集群】/*dubbox是当当在dubbo上进行二次开发后*/
	2. 什么是dubbo
		1. alibaba旗下开源的项目
		2. 理解dubbo的四个角色
		3. 是同步通讯技术
	3. 如何使用dubbo

soa：面向服务的架构
服务：有一定业务逻辑，可被别人调用的接口

Webservice基于soap协议，传送的xml，因此效率不高。技术古老。通常是天气预报会用。
替代：使用RestFul风格的服务，http+json。一般对外提供接口

socket和package
ejb开发 重量级开发，古老，没人用了

ThreadLocal 保证线程安全。每一个线程都有一个treadlocal

## Day3
软件即服务

常见的异常解决办法
1. 启动前要确保所有项目都安装过
2. manager和web先启动谁无所谓，不会报错
3. 所有用来传输的数据都要事先serilizable接口
	1. dubbo是以二进制传输的，因此效率很高
4. 资源拷贝问题
	1. src文件夹下默认只编译java文件，不会编译xml文件

要启动监控中心，必须先启动zookeeper

log4j和监控中心一定要加上，方便自己调错

js中定义一个变量a，如果为null，undefined，0，false，""的时候，if(a){},a相当于false，除此之外，都相当于true

$("<div>")创建一个div

### FastDFS
分布式文件系统。线性扩容

FastDFS由两部分组成，其中tracker负责计算，storage负责存储

## Day4
**sku** 最小库存单位，能根据各种属性唯一确定一个商品
商品：
1. 关键属性--找商品：名称、品牌
2. 销售属性--确定某一个商品：颜色、价格、大小

SEO 搜索引擎优化。搜索引擎喜欢静态资源，所以提供伪静态化方案

瀑布流——鼠标滚动，出发事件，引发ajax发送异步请求

## Day5
一般来说最后开发首页。

**redis**

NoSQL数据库，内存数据库。将所有数据放在内存中。Key-Value格式
优点：读写速度快。
缺点：内存大小限制；占内存。

缓存同步:一般来说开发中要保证数据唯一性。即，只有一份数据起作用。但是缓存机制，是不符合这个原则的。因此我们要保证缓存中的数据与数据库中的数据要一样，于是就有了缓存同步。

加缓存的目的，仅仅是为了提高用户体验。**所有优化操作，不能影响业务逻辑的运行。**

什么是分布式事务？dubbo、webservice、hissian的区别?
是否用过图片服务器？

项目经理：良好的沟通，完善的逻辑思维

只要对查询速度有要求，就可以用缓存。

Redis不适合保存内容大的数据，是单线程的。

Redis的五种基本数据类型。都是以key-value形式做基础，存的所有数据都是字符串
1. String
	1. **get、set**。命令不区分大小写。**incr加一、decr减一**命令
	2. key、value区分大小写
2. Hash
	1. 相当于一个key对一个map
	2. **hset、hget**，向hash中设值取值；hincrby
3. List 有顺序可重复
	1. lpush：从左添加；rpush：从右添加
	2. lrange 查看；lpop 从左弹出；rpop 从右弹出
4. Set 元素无顺序，不重复
	1. sadd、smembers srem
5. SortedSet 有顺序不重复
	1. 做排行榜

是否有事务问题？考虑业务逻辑是否需要具有原子性（一个整体，全部成功或全部失败）

redis的事务做的不是特别好，只提供了watch。只是在有改动的时候，进行提示。

redis的持久化
rdb 快照
aof bgrewriteaof命令-删除aof中冗余命令行

## Day6
为什么要在spring中配置solrserver？--在程序运行期间保证只有一个solrserver。因为不断获取连接很消耗资源

为什么搭建zookeeper的集群？--保证zookeeper的高可用，solr集群基于zookeeper。所有solr服务器都使用zookeeper管理的**配置文件**。zookeeper充当solr集群的入口，由zookeeper计算访问哪一个服务器【**负载均衡**】。因此，我们搭建了zookeeper集群来保证zookeeper的高可用。

1. 搜索功能完成
	1. service
	2. controller
	3. 图片展示
2. solrcloud
	1. solr提供的的分布式搜索方案。基于zookeeper
	2. 搭建solr集群
3. 全局异常处理

一个完整的索引库分成多个分片。所有分片集合起来，才是一个完整的索引库。
zookeeper的作用：1.统一管理配置文件；2.负载均衡，是solr集群的入口

## Day8
为什么要使用ActiveMQ？
	
	为了使程序中与主逻辑无关的逻辑不影响主逻辑的运行。为了解耦，为了业务拆分明确。

ActiveMQ与dubbo的区别？
	
	dubbo是同步请求服务，ActiveMQ是异步服务。dubbo可以集群，ActiveMQ一般来说是没有集群的。

	需要实时调用服务，需要得到结果的时候用dubbo；用dubbo时，每件事都是必须完成的。开线程的时候，不需要结果的时候用ActiveMQ。

ActiveMQ发消息尽量放在controller层里，因为service里面有事务，可能回滚。可能商品还没添加成功，就发了消息，那么消费者查询数据库找不到，又无法收第二次。

ActiveMQ发送消息却丢失了，怎么办？
信息丢失肯定会有，但是情况不多。

RabbitMQ有重发机制，连发5次没成功，就把这个错误放到错误池里。

ActiveMQ小巧、方便，RabbitMQ重量级。

Redis的订阅发布功能简单，但是用的不多。因为不专业，发的这些信息都没有保存到库中。

广播的形式是主要用的。方便解耦，你发你的信息，别人愿意收听就收听。接受的信息一样，不同的人做不同的处理。

## Day9

商品详情展示--jsp+redis 已经可以满足中小型网站，挺快的了

静态化除了jsp+redis和freemarker，还可以用Url这个类

什么时候添加缓存？
无法预测什么商品会被查，什么查得多。因此，我们选择给缓存添加时效，那么查得多的就会在redis中。命中率不高，好处是节省了redis的内存空间，最大限度的保证热门商品在redis中。

如何给缓存数据起id？
key中包含id，通过后缀区别商品和商品描述信息。

FreeMarker
本质上就是一个模板生成工具。

> 反馈
> 仓库只剩一件，两个人买。实际处理是两个人都下单成功，然后商家自己去调货，调货不成功就给你打个电话让你退货。现实中，库存在商品出库的时候才减。页面上显示的库存永远是假的。

> 淘宝卖家C 一般都是拍下减库存
> 大卖家B 一般是付款减库存

MongoDB主要用在爬虫爬数据的时候多用

jstl中 转日期：引入fmt标签，然后再用这个标签

freemarker中${myval!"myval is null"}，myval为空则显示“!”后面的字符串

include标签比较常用，如网站的上下侧通常固定显示的东西

什么是宏？
规定一个执行的方法

如何动态生成word？
先转成xml，找到对应值，用freemarker语法修改

tomcat的三种发布方法

秒杀

防盗链
	看到别人的图片很不错，直接一个img标签里面直接一个src指过去。这种行为称为盗链。当你的页面引用了别人的图片，那么在请求的时候就会访问别人的服务器，给别人的服务器造成压力。
	
	防盗链，即防止别人做上述事情。设置白名单-一堆能访问我的图片的主机/ip。获取访问我图片的主机ip，看它是否在我的白名单里面，如果在就允许访问，不在就不允许。

## Day10
FreeMarker原理、语法 判断结构

缓存：每打开一个页面，访问三四次数据库，一个是速度慢，一个是数据库压力大。

nginx-并发量只要超过300，那么就可以使用nginx了。

JavaEE规范：
jsp/servlet规范：部署一个项目，可以把jsp转成servlet，并运行。Apache不支持这个规范。

nginx不支持java项目。
1. http服务器。支持存储静态资源
2. 配置虚拟主机
	1. 通过域名和端口拼接起来
3. 反向代理、负载均衡

负载均衡：前提是多个服务器提供相同服务(集群)，具体谁提供给我服务，交给nginx来计算。

生成静态资源后，我们不再使用tomcat发布静态资源了。我们会使用nginx发布

[WEB服务器、应用程序服务器、HTTP服务器区别](http://blog.csdn.net/u010098331/article/details/51879450)

[JavaEE的十三种技术规范](http://www.xuebuyuan.com/2120845.html)

### nginx
因为nginx是c语言开发的，所以速度快。为什么c语言开发的速度就快呢？
	linux、windows操作系统就是用c语言写的。在c的天下运行c，当然很快哦。

怎么确定一台主机?主机名+端口号

主机名是什么？同域名。一级域名花钱，二级域名不花钱（自己映射出来的）。

反向代理：看**主动权**是多方还是少方。从多的一方发出，到少的一方--正向代理；从少的一方发出，到多的一方--反向代理

### sso
将session放到所有服务器都可以访问到的地方。session是个大map，以key-value形式存在，而且有时间限制，并且我们没事就喜欢操作一下它。

一直操作session的话，session就不会过期

> 如果做的是电商项目，首先要确认的是网站的访问量，再确认并发量

### 设计模式
23种设计模式

工厂模式
	用工厂模式的，一般是面向接口开发。好处，你的实现类想怎么换怎么换。创建对象用工厂模式。

责任链模式
	很多拦截器去拦截请求，如果这个请求是你的事情，那你就拦着处理然后响应给用户。很多很多拦截器等着为你做事情。eg:struts2

代理模式
	创建一个代理实现类，和真正的类实现同样的接口。

装饰模式
	io流。参数中要包含被增强对象，因为原有功能都要有

单例模式
	懒汉式
		一开始没有bean。如果调用方法需要对象了，我再创建。懒汉式有线程问题
	饿汉式
		饿汉式问题在于占用内存。

组合模式
	树形结构就是组合模式。任意一段，和整体的结构完全一致。取局部可观全貌。

## Day11
是什么？有啥子用？
nginx 工业化程度很高。（批量生产）因为它稳定性、性能都很高。nginx不能支持servlet规范，他不能发布java项目，不能将java文件编译成class文件。

什么是虚拟主机？
	主机，相当于一个服务。域名+端口，区分不同的主机

一群人主动连一个--正向代理
一个人主动连一群人--反向代理--一个nginx到多态服务器

加密的时候，不要只加密password，给username也连着一起加密。保证生成的密文绝对不能重复

我们开发的时候，在做用户登录的时候，使用redis，我们要使用hash

单点登录的核心业务就是模拟session。tocken放到cookie里面。setdomain设置有效域名（一级域名）。

通过token查询用户信息，只要查询到了数据，只要用到了session，就要重置一下时间。（激活）

回调：在购物的时候，进到了产品详情页面，准备购买，但是需要登录，所以跳去了登录页面，登录完后要再次回去详情页面。

### 补充：
MyBatis

逆向工程用的很少，需要我们自己写。一般来说，select这种语句，我们一般返回hashmap（不返回对象）。

改配置文件，不需要重新编译java代码；改jsp，也不需要重新编译，重启都不用。

只要sql经常变化（不管是mybatis还是hibernate），就可以返回hashmap。

配置镜像

迭代式的敏捷开发
先从无到有，再锦上添花。

